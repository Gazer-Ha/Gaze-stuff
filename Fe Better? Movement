function missing(t, f, fallback)
if type(f) == t then return f end
return fallback
end
cloneref = missing("function", cloneref, function(...) return ... end)

local Services = setmetatable({}, {
__index = function(_, name)
return cloneref(game:GetService(name))
end
})

local Players = Services.Players
local RunService = Services.RunService
local StarterGui = Services.StarterGui

local lp = Players.LocalPlayer
local c = lp.Character or lp.CharacterAdded:Wait()
local humanoid = c:WaitForChild("Humanoid")
local hrp0 = c:WaitForChild("HumanoidRootPart")

hrp0.Archivable = true
local hrp1 = hrp0:Clone()
c.Parent = nil
hrp0.Parent = hrp1
local rootJoint = hrp0:FindFirstChild("RootJoint") or hrp0:FindFirstChildWhichIsA("Motor6D")
if rootJoint then
rootJoint.Part0 = nil
end
hrp1.Parent = c
c.Parent = workspace

hrp0.Transparency = 0.5
hrp0.CanCollide = false
hrp1.CanCollide = false

local maxTilt = 40
local fadeSpeed = 10
local tiltMultiplier = 1.2
local currentTiltX = 0
local currentTiltZ = 0
local hrp1TiltFactor = 0.4
local jumpTiltFactor = 1/3

local isR6 = humanoid.RigType == Enum.HumanoidRigType.R6
if isR6 then
StarterGui:SetCore("SendNotification", {
Title = "FE Better? Movement 0.1",
Text = "R6 detected: no sideways anim, custom jump",
Duration = 10
})
coroutine.wrap(function() loadstring(game:HttpGet("https://raw.githubusercontent.com/Gazer-Ha/NOT-MINE/refs/heads/main/R6%20animation%20custe"))() end)()
end
for _, track in pairs(humanoid:GetPlayingAnimationTracks()) do
track:Stop()
end
StarterGui:SetCore("SendNotification", {
Title = "FE Better? Movement 0.1",
Text = "Reset/Die To Reset Anim",
Duration = 5
})
coroutine.wrap(function() loadstring(game:HttpGet("https://raw.githubusercontent.com/Gazer-Ha/Gaze-stuff/refs/heads/main/Fe%20Better%3F%20Shiftlock"))() end)()

local sideTrack
if not isR6 then
local sideAnim = Instance.new("Animation")
sideAnim.AnimationId = "rbxassetid://132218385473651"
sideTrack = humanoid:LoadAnimation(sideAnim)
sideTrack.Priority = Enum.AnimationPriority.Movement
end

local lastRightDot, lastTimePos = 0, 0

local function getMoveDirection()
local dir = humanoid.MoveDirection
if dir.Magnitude > 0 then
return dir.Unit
end
return Vector3.zero
end

RunService.Heartbeat:Connect(function(dt)
if not c or not c.Parent then return end
local moveDir = getMoveDirection()
local speed = hrp1.Velocity.Magnitude
local targetTiltX = 0
local targetTiltZ = 0
local state = humanoid:GetState()
if speed > 0.1 then
local look = hrp1.CFrame.LookVector
targetTiltX = math.clamp(-moveDir:Dot(look) * tiltMultiplier * speed, -maxTilt, maxTilt)
targetTiltZ = math.clamp(-moveDir:Dot(hrp1.CFrame.RightVector) * tiltMultiplier * speed, -maxTilt, maxTilt)
end
if state == Enum.HumanoidStateType.Jumping or state == Enum.HumanoidStateType.Freefall then
targetTiltX = targetTiltX * jumpTiltFactor
targetTiltZ = targetTiltZ * jumpTiltFactor
end
currentTiltX += (targetTiltX - currentTiltX) * dt * fadeSpeed
currentTiltZ += (targetTiltZ - currentTiltZ) * dt * fadeSpeed
local baseCFrame = hrp1.CFrame
local tiltCFrame = CFrame.Angles(math.rad(currentTiltX), 0, math.rad(currentTiltZ))
local hrp1TiltCFrame = CFrame.Angles(math.rad(currentTiltX * hrp1TiltFactor), 0, math.rad(currentTiltZ * hrp1TiltFactor))
hrp1.CFrame = baseCFrame * hrp1TiltCFrame
hrp0.CFrame = baseCFrame * tiltCFrame
hrp0.Velocity = Vector3.zero
hrp0.RotVelocity = Vector3.zero
end)

if not isR6 then
RunService.PreSimulation:Connect(function()
local state = humanoid:GetState()
local moveDir = humanoid.MoveDirection
local velocity = hrp1.Velocity
local actualSpeed = Vector3.new(velocity.X,0,velocity.Z).Magnitude
if sideTrack.IsPlaying then
lastTimePos = sideTrack.TimePosition
end
if state==Enum.HumanoidStateType.Jumping or state==Enum.HumanoidStateType.Freefall or actualSpeed<0.1 then
if sideTrack.IsPlaying then sideTrack:Stop(0.2) end
return
end
local forwardDot = moveDir:Dot(hrp1.CFrame.LookVector)
local rightDot = moveDir:Dot(hrp1.CFrame.RightVector)
if math.abs(rightDot)>math.abs(forwardDot) then
if not sideTrack.IsPlaying then
sideTrack:Play(0.2)
sideTrack.TimePosition = lastTimePos
end
local minSpeed,maxSpeed = 0,15
local alpha = math.max((actualSpeed-minSpeed)/(maxSpeed-minSpeed),0)
local weight = 0.5+0.5*math.clamp(alpha,0,1)
local baseSideSpeed = 1.5
local sideSpeed = baseSideSpeed*alpha
sideSpeed = sideSpeed*(rightDot>=0 and -1 or 1)
if (rightDot>0 and lastRightDot<0) or (rightDot<0 and lastRightDot>0) then
sideTrack.TimePosition = lastTimePos
end
sideTrack:AdjustSpeed(sideSpeed)
sideTrack:AdjustWeight(weight)
else
if sideTrack.IsPlaying then sideTrack:Stop(0.2) end
end
lastRightDot = rightDot
end)
end
